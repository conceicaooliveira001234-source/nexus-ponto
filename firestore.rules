rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ═══════════════════════════════════════════════════════════════
    // COMPANIES - Apenas usuários autenticados podem ler/escrever
    // ═══════════════════════════════════════════════════════════════
    match /companies/{companyId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // ═══════════════════════════════════════════════════════════════
    // EMPLOYEES - Apenas usuários autenticados podem ler/escrever
    // ═══════════════════════════════════════════════════════════════
    match /employees/{employeeId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // ═══════════════════════════════════════════════════════════════
    // LOCATIONS - Apenas usuários autenticados podem ler/escrever
    // ═══════════════════════════════════════════════════════════════
    match /locations/{locationId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // ═══════════════════════════════════════════════════════════════
    // USERS - Apenas usuários autenticados podem ler/escrever
    // ═══════════════════════════════════════════════════════════════
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // ═══════════════════════════════════════════════════════════════
    // ATTENDANCE - ACESSO PÚBLICO PARA CRIAR REGISTROS
    // ═══════════════════════════════════════════════════════════════
    // Funcionários usam reconhecimento facial (não Firebase Auth)
    // Por isso, precisam de permissão pública para criar registros
    // ═══════════════════════════════════════════════════════════════
    match /attendance/{attendanceId} {
      // LEITURA: Qualquer pessoa pode ler (para o histórico)
      allow read: if true;
      
      // CRIAÇÃO: Qualquer pessoa pode criar (para registrar ponto)
      allow create: if true;
      
      // ATUALIZAÇÃO: Apenas usuários autenticados (admins)
      allow update: if request.auth != null;
      
      // EXCLUSÃO: Apenas usuários autenticados (admins)
      allow delete: if request.auth != null;
    }
  }
}